# 剧本生成优化说明 - 问题1修复

## 🎯 核心问题

用户反馈：生成的剧本**不够有趣**，缺乏细节和生活质感。

参考 clip_005（海苔腰果偷吃记）这个经典案例，它的特点是：
- 细节极其丰富（"一个月喝三瓶可乐"、"100日元等于7块钱"）
- 内心独白多（"我心想"、"我想着"、"哎呀我心想这可怎么办"）
- 场景化叙事（完整对话场景，而不是转述）
- 情绪细腻（"把我紧张的都睡不着觉了"）

## ❌ 之前的问题

### ScriptGeneratorV2 会生成**总结式台词**

**坏例子**（像在写摘要）：
```
"那时候我刚到日本，穷得叮当响"
"室友是个富二代，有很多零食"
"我偷吃了室友的腰果，很紧张"
"后来坦白了，室友很宽容"
```

这种台词的问题：
- ❌ 太概括，缺乏具体细节
- ❌ 没有内心戏，感受不到角色的思考过程
- ❌ 没有场景感，像在读梗概
- ❌ 缺乏生活质感，没有真实感

## ✅ 优化方案

### 修改了 SYSTEM_PROMPT 和 user prompt

核心改进点：

#### 1. 加入错误/正确对比示例

明确告诉 LLM 什么是**不要的**（总结式），什么是**要的**（场景化）：

**不要（❌）**：
- "那时候我很穷"
- "室友很好"
- "我很紧张"

**要这样（✅）**：
- "我那个时候一个月给自己订的，一个月喝三瓶可乐，因为我特别爱喝，但是当时没钱"
- "他说'你想吃就吃呀随便吃呀'。我说真的吗？我一想哇，这么慷慨"
- "把我紧张的都睡不着觉了，每天晚上我都没睡着，因为当我意识到腰果没了"

#### 2. 写作技巧清单（7个必备元素）

强制要求每句台词包含：

✅ **必须包含的元素**：
1. **具体数字/细节** - "一个月三瓶可乐" 而不是 "很少"
2. **内心独白** - "我心想"、"我想着"、"哎呀"、"我一想"
3. **情绪描写** - "紧张的睡不着"、"心理负担可重了"
4. **生活质感** - 酱油拌饭、冰箱、汇率、具体物品名称
5. **对话场景** - 写完整对话，不要转述"他说了..."
6. **时间推进** - "第二天"、"结果"、"后来"
7. **心路历程** - 犹豫→行动→后悔→释然，展示变化过程

#### 3. 语言风格指导

- 口语化、有停顿、自我修正（"三瓶还是四瓶"）
- 允许重复强调（"真的吗？真的吗？"）
- 用"然后"、"结果"、"后来"连接，像在聊天
- 展示思考过程，不要直接给结论

#### 4. 叙事节奏强调

- 不要跳过过程！要展示心路历程
- 铺垫要充分（先说穷→可乐限量→室友富→看到腰果→起贪念）
- 高潮要有张力（第一次偷吃→第二天又吃→发现吃完→失眠→坦白→释然）
- 用内心戏拉长时间感

#### 5. 提高 token 限制

从 `max_tokens=2000` 提升到 `max_tokens=3000`，因为场景化台词更长。

## 📊 预期效果

### 之前（总结式）

```
台词1: "那时候我刚到日本，穷得叮当响"
台词2: "室友是富二代，冰箱里永远堆满零食"
台词3: "我偷吃了她的腰果，特别紧张"
台词4: "后来坦白了，室友说没关系"
```

### 现在（场景化）

```
台词1: "我跟你们说，我那个时候一个月给自己订的，一个月喝三瓶可乐，三瓶还是四瓶，因为我特别爱喝可乐，但是当时没钱。我那时候可不是雪碧拌饭，雪碧太贵了"

台词2: "我看着那个冰箱里的，他的那个海苔炒腰果，我好馋呀。我想着海苔的腰果都藏在那海苔里面，我想我吃一个腰果，他回来他又不数，他应该不知道吧，偷吃一个"

台词3: "第二天又想着，要不我再偷吃一个吧，他回来应该不知道吧。结果我吃着吃着，他还没回来，我已经把里面的腰果吃完了，只剩下海苔了"

台词4: "把我紧张的都睡不着觉了，每天晚上我都没睡着，因为当我意识到，我在里头一翻腾，发现腰果没了。哎呀我心想这可怎么办"

台词5: "第二天我就实在是，我太惦记这事了，我压力太大了，我就给他坦白了。我说嗯，我把你那个腰果吃掉了，我一开始想给你留一点的，但是它太好吃了"

台词6: "然后他就笑了，他说'你想吃就吃呀随便吃呀'。我说真的吗？我一想哇，这么慷慨我真的可以随便吃吗？他说'对呀，你想吃我再给你拿一盒来啊'。人心上的大石头才终于放下来了"
```

## 🔄 使用方法

在 notebook 中，重新运行 Cell 9（ScriptGeneratorV2 定义）后，再生成剧本：

```python
# Phase 1: 生成剧本（现在会生成场景化台词）
state = engine_v2.create_performance(
    name="六螺",
    persona="活泼自嘲的主播，口癖：我觉得、对吧、就是说",
    background="留学日本多年",
    topic="留学时偷吃室友腰果的故事",
    language="zh"
)
```

生成的剧本应该会：
- ✅ 有丰富的生活细节
- ✅ 有大量内心独白
- ✅ 有完整的对话场景
- ✅ 有情绪起伏和心理变化
- ✅ 有具体的数字和物品名称
- ✅ 像真实的VTuber在说话

## 📝 关键变更文件

- `workflow/jupyter_notebook/echuu_with_tts.ipynb` - Cell 9
  - 修改了 `ScriptGeneratorV2.SYSTEM_PROMPT`
  - 修改了 `generate()` 方法中的 `prompt`
  - 提高了 `max_tokens` 从 2000 → 3000

## 🎯 下一步

如果剧本质量还不够好，可以继续优化：
1. 在 prompt 中加入更多 clip_005 的完整片段作为示例
2. 要求 LLM 先写故事大纲，再扩展成场景化台词（两步生成）
3. 使用更强的模型（如 Claude Opus）来生成剧本
4. 加入后处理：检查台词是否包含必需元素，不合格就重新生成


